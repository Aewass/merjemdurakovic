---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';
import { ArrowLeft } from 'lucide-astro';

// Update the types for our data structure
type CatalogImage = {
  src: string;
  alt: string;
  caption?: string;
};

type CatalogItem = {
  name: string;
  description: string;
  images: CatalogImage[];
};

type CategoryData = {
  number: string;
  title: string;
  category: string;
  description: string;
  items: CatalogItem[];
};

export function getStaticPaths() {
  return [
    {
      params: { id: 'catalogs' },
      props: {
        category: {
          number: "01",
          title: "Catalogs",
          category: "Category",
          description: "Collection of product catalogs for various clients",
          items: [
            {
              name: "iform",
              description: "Product catalog collection for iform",
              images: [
                { 
                  src: "/src/assets/catalogs/catalog-iform/1.png", 
                  alt: "iform catalog page 1",
                  caption: "Product showcase page" 
                },
                { 
                  src: "/src/assets/catalogs/catalog-iform/2.png", 
                  alt: "iform catalog page 2",
                  caption: "Technical specifications" 
                }
              ]
            },
            {
              name: "lezaj-trade",
              description: "Product catalog collection for Lezaj Trade",
              images: [
                { src: "/src/assets/catalogs/catalog-lezaj-trade/1.png", alt: "Lezaj Trade catalog page 1" },
                { src: "/src/assets/catalogs/catalog-lezaj-trade/2.png", alt: "Lezaj Trade catalog page 2" },
                { src: "/src/assets/catalogs/catalog-lezaj-trade/3.png", alt: "Lezaj Trade catalog page 3" },
              ]
            },
            {
              name: "mega",
              description: "Product catalog for Mega",
              images: [
                { src: "/src/assets/catalogs/catalog-mega/1.png", alt: "Mega catalog page 1" },
                { src: "/src/assets/catalogs/catalog-mega/2.png", alt: "Mega catalog page 2" },
                { src: "/src/assets/catalogs/catalog-mega/3.png", alt: "Mega catalog page 3" }
              ]
            },
            {
              name: "shams",
              description: "Product catalog collection for Shams",
              images: [
                { src: "/src/assets/catalogs/catalog-shams/1.png", alt: "Shams catalog page 1" },
                { src: "/src/assets/catalogs/catalog-shams/2.png", alt: "Shams catalog page 2" },
                { src: "/src/assets/catalogs/catalog-shams/3.png", alt: "Shams catalog page 3" }
              ]
            },
            {
              name: "stanic",
              description: "Product catalog collection for Stanic",
              images: [
                { src: "/src/assets/catalogs/catalog-stanic/1.png", alt: "Stanic catalog page 1" },
                { src: "/src/assets/catalogs/catalog-stanic/2.png", alt: "Stanic catalog page 2" },
                { src: "/src/assets/catalogs/catalog-stanic/3.jpg", alt: "Stanic catalog page 3" },
              ]
            },
            {
              name: "zgi",
              description: "Product catalog collection for ZGI",
              images: [
                { src: "/src/assets/catalogs/catalog-zgi/1.jpg", alt: "ZGI catalog page 1" },
                { src: "/src/assets/catalogs/catalog-zgi/2.jpg", alt: "ZGI catalog page 2" },
                { src: "/src/assets/catalogs/catalog-zgi/3.jpg", alt: "ZGI catalog page 3" }
              ]
            },
            {
              name: "zgi2",
              description: "Product catalog collection for ZGI (Volume 2)",
              images: [
                { src: "/src/assets/catalogs/catalog-zgi2/1.jpg", alt: "ZGI Vol.2 catalog page 1" },
                { src: "/src/assets/catalogs/catalog-zgi2/2.jpg", alt: "ZGI Vol.2 catalog page 2" },
                { src: "/src/assets/catalogs/catalog-zgi2/3.jpg", alt: "ZGI Vol.2 catalog page 3" }
              ]
            }
          ]
        } as CategoryData
      }
    }
  ];
}

const { id } = Astro.params;
const { category } = Astro.props;
---

<Layout title={`${category.title} - ${category.category}`}>
  <main class="relative min-h-screen">
    <div class="fixed inset-0">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-rose-200/40 via-rose-100/30 to-transparent"></div>
    </div>

    <div class="relative">
      <article class="pt-32 pb-24">
        <div class="max-w-6xl mx-auto px-6 sm:px-8">
          <!-- Back Button -->
          <a 
            href="/#portfolio" 
            class="inline-flex items-center gap-2 text-gray-500 hover:text-purple-600 transition-colors duration-300 mb-12 group"
          >
            <ArrowLeft class="w-4 h-4 group-hover:-translate-x-1 transition-transform duration-300" />
            <span class="text-sm">Back to Portfolio</span>
          </a>

          <!-- Header -->
          <header class="mb-16">
            <div>
              <div class="flex items-center gap-2 text-purple-600 mb-4">
                <span class="font-mono">{category.number}</span>
                <span class="text-gray-300">â€”</span>
                <span>{category.category}</span>
              </div>
              <h1 class="text-5xl font-bold mb-6">
                {category.title}
              </h1>
              <p class="text-xl text-gray-600 max-w-2xl">
                {category.description}
              </p>
            </div>
          </header>

          <!-- Catalogs List -->
          <div class="space-y-40">
            {category.items.map(item => (
              <div class="catalog-item">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 md:gap-16 items-start">
                  <div>
                    <h2 class="text-4xl font-bold mb-4 capitalize">{item.name.replace('-', ' ')}</h2>
                    <p class="text-lg text-gray-600 mb-8">{item.description}</p>
                    <div class="flex items-center">
                      <span class="inline-flex items-center py-1.5 px-3 bg-purple-50/70 text-sm text-gray-800 rounded-full">
                        <span class="w-1.5 h-1.5 bg-purple-500 rounded-full mr-2"></span>
                        {item.images.length} {item.images.length === 1 ? 'page' : 'pages'}
                      </span>
                    </div>
                  </div>
                  
                  <!-- Image Mosaic Gallery -->
                  <div class="image-mosaic relative">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                      {item.images.map((image, index) => (
                        <div class={`overflow-hidden rounded-lg bg-white shadow-md transition-all duration-300 hover:shadow-xl ${
                          index === 0 ? 'col-span-2 row-span-2' : ''
                        }`}>
                          <div class="relative group cursor-pointer aspect-[4/3]">
                            <img 
                              src={image.src} 
                              alt={image.alt || `${item.name} image ${index + 1}`}
                              class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"
                              data-fullview={image.src}
                            />
                            {image.caption && (
                              <div class="absolute bottom-0 left-0 right-0 bg-black/70 text-white p-2 text-sm opacity-0 group-hover:opacity-100 transition-opacity">
                                {image.caption}
                              </div>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    <!-- Full-size image viewer (hidden by default) -->
                    <div id="imageViewer" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
                      <button id="closeViewer" class="absolute top-6 right-6 text-white hover:text-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                      </button>
                      <img id="fullImage" src="" alt="Full size image" class="max-h-[90vh] max-w-[90vw] object-contain" />
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </article>

      <Footer />
    </div>
  </main>
</Layout>

<script>
  // Initialize image viewers
  document.querySelectorAll('.image-mosaic img[data-fullview]').forEach(img => {
    img.addEventListener('click', () => {
      const fullview = img.getAttribute('data-fullview');
      const viewer = document.getElementById('imageViewer');
      const fullImage = document.getElementById('fullImage') as HTMLImageElement;
      
      if (fullview && viewer && fullImage) {
        fullImage.src = fullview;
        fullImage.alt = (img as HTMLImageElement).alt;
        viewer.classList.remove('hidden');
        viewer.classList.add('flex');
        
        // Prevent scrolling on body
        document.body.style.overflow = 'hidden';
      }
    });
  });
  
  // Close viewer
  document.getElementById('closeViewer')?.addEventListener('click', () => {
    const viewer = document.getElementById('imageViewer');
    if (viewer) {
      viewer.classList.add('hidden');
      viewer.classList.remove('flex');
      
      // Restore scrolling
      document.body.style.overflow = '';
    }
  });
  
  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      const viewer = document.getElementById('imageViewer');
      if (viewer && !viewer.classList.contains('hidden')) {
        viewer.classList.add('hidden');
        viewer.classList.remove('flex');
        document.body.style.overflow = '';
      }
    }
  });
</script>

<style>
  .image-mosaic img {
    transition: transform 0.3s ease;
  }
  
  .image-mosaic img:hover {
    transform: scale(1.05);
  }
</style> 