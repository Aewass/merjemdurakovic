---
import Layout from '../../../layouts/Layout.astro';
import Footer from '../../../components/Footer.astro';
import { ArrowLeft, Maximize2, ChevronLeft, ChevronRight, X } from 'lucide-astro';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

// Update the types for our data structure
type CatalogImage = {
  src: string;
  alt: string;
  caption?: string;
};

type CatalogItem = {
  name: string;
  description: string;
  images: CatalogImage[];
};

type CategoryData = {
  number: string;
  title: string;
  category: string;
  description: string;
  items: CatalogItem[];
};

export function getStaticPaths() {
  return [
    {
      params: { id: 'branding' },
      props: {
        category: {
          number: "01",
          title: "Brending",
          category: "Kategorija",
          description: "Sistem vizuelnog identiteta za Auto Centar Mint, baziran na postojećem logotipu i paleti boja. Proširen u kompletnu knjigu smernica brenda sa definisanom tipografijom, layoutom, ikonografijom, vizuelnim elementima i pravilima korišćenja. Primenjen na poslovne kartice, pisma, brendirane materijale poput šolja i odeće.",
          items: [
            {
              name: "AC Mint",
              description: "Identitet brenda",
              images: [
                { 
                  src: "/branding/branding-ac-mint/1.jpg", 
                  alt: "AC Mint identitet brenda",
                  caption: "Dizajn logotipa i vizuelni identitet" 
                },
                { 
                  src: "/branding/branding-ac-mint/2.jpg", 
                  alt: "AC Mint dizajn logotipa",
                  caption: "Varijacije logotipa i primene" 
                },
                { 
                  src: "/branding/branding-ac-mint/3.jpg", 
                  alt: "AC Mint primene brenda",
                  caption: "Primene brenda i papirologija" 
                },
                { 
                  src: "/branding/branding-ac-mint/4.jpg", 
                  alt: "AC Mint dizajn ambalaže",
                  caption: "Rešenja dizajna ambalaže" 
                },
                { 
                  src: "/branding/branding-ac-mint/5.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/6.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/7.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/8.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/9.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/10.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/11.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/12.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/13.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/14.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/15.jpg", 
                  alt: "AC Mint smernice brenda",    
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/16.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/17.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/18.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/19.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/20.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/21.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/22.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/23.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/24.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                },
                { 
                  src: "/branding/branding-ac-mint/25.jpg", 
                  alt: "AC Mint smernice brenda",
                  caption: "Vodič stila brenda i standardi" 
                }
              ]
            }
          ]
        }
      }
    },
    {
      params: { id: 'catalogs' },
      props: {
        category: {
          number: "02",
          title: "Brošure i Katalozi",
          category: "Kategorija",
          description: "Ova sekcija sadrži štampane materijale kao što su brošure, katalozi, izveštaji i vodiči iz različitih oblasti. Svaki projekat odražava stil brenda, ton i vizuelni jezik prilagođen svom kontekstu.",
          items: [
            {
              name: "iForm",
              description: "Izveštaj o ugljeničnom otisku",
              images: [
                { 
                  src: "/catalogs/catalog-iform/1.png", 
                  alt: "iform katalog strana 1",
                  caption: "Stranica za prikaz proizvoda" 
                },
                { 
                  src: "/catalogs/catalog-iform/2.png", 
                  alt: "iform katalog strana 2",
                  caption: "Tehničke specifikacije" 
                }
              ]
            },
            {
              name: "Ležaj Trade",
              description: "Katalog za industrijski program prodaje",
              images: [
                { src: "/catalogs/catalog-lezaj-trade/2.png", alt: "Lezaj Trade katalog strana 1" },
                { src: "/catalogs/catalog-lezaj-trade/3.png", alt: "Lezaj Trade katalog strana 3" },
              ]
            },
            {
              name: "Mega Trans",
              description: "Izveštaj o ugljeničnom otisku",
              images: [
                { src: "/catalogs/catalog-mega/1.png", alt: "Mega katalog strana 1" },
                { src: "/catalogs/catalog-mega/2.png", alt: "Mega katalog strana 2" },
              ]
            },
            {
              name: "Shams",
              description: "Katalog proizvoda",
              images: [
                { src: "/catalogs/catalog-shams/1.png", alt: "Shams katalog strana 1" },
                { src: "/catalogs/catalog-shams/2.png", alt: "Shams katalog strana 2" },
                { src: "/catalogs/catalog-shams/3.png", alt: "Shams katalog strana 3" },
              ]
            },
            {
              name: "Stanic",
              description: "Katalog proizvoda",
              images: [
                { src: "/catalogs/catalog-stanic/1.png", alt: "Stanic katalog strana 1" },
                { src: "/catalogs/catalog-stanic/2.png", alt: "Stanic katalog strana 2" },
                { src: "/catalogs/catalog-stanic/3.jpg", alt: "Stanic katalog strana 3" },
              ]
            },
            {
              name: "ZGI",
              description: "Katalog proizvoda",
              images: [
                { src: "/catalogs/catalog-zgi/1.jpg", alt: "ZGI katalog strana 1" },
                { src: "/catalogs/catalog-zgi/2.jpg", alt: "ZGI katalog strana 2" },
                { src: "/catalogs/catalog-zgi/3.jpg", alt: "ZGI katalog strana 3" },
              ]
            },
            {
              name: "ZGI 2",
              description: "Katalog proizvoda",
              images: [
                { src: "/catalogs/catalog-zgi2/1.jpg", alt: "ZGI 2 katalog strana 1" },
                { src: "/catalogs/catalog-zgi2/2.jpg", alt: "ZGI 2 katalog strana 2" },
                { src: "/catalogs/catalog-zgi2/3.jpg", alt: "ZGI 2 katalog strana 3" },
              ]
            }
          ]
        }
      }
    },
    {
      params: { id: 'visit-cards' },
      props: {
        category: {
          number: "03",
          title: "Vizit Karte",
          category: "Kategorija",
          description: "Profesionalni dizajni poslovnih kartica koji hvataju suštinu svakog brenda uz održavanje funkcionalnosti i čitljivosti.",
          items: [
            {
              name: "Ležaj Trade",
              description: "Dizajn poslovne kartice",
              images: [
                { src: "/visit-cards/visit-card-lezaj-trade/1.jpg", alt: "Lezaj Trade poslovna kartica" }
              ]
            },
            {
              name: "Zerro Max",
              description: "Dizajn poslovne kartice",
              images: [
                { src: "/visit-cards/visit-card-zerro-max/2.jpg", alt: "Zerro Max poslovna kartica" }
              ]
            }
          ]
        }
      }
    },
    {
      params: { id: 'books' },
      props: {
        category: {
          number: "04",
          title: "Dizajn Naslovnica",
          category: "Kategorija",
          description: "Dizajni naslovnica knjiga koji hvataju suštinu sadržaja uz stvaranje vizuelne privlačnosti i tržišne vrednosti.",
          items: [
            {
              name: "Dizajn Knjiga",
              description: "Dizajn naslovnica za različite publikacije",
              images: [
                { src: "/books/book/1.jpg", alt: "Dizajn naslovnice knjige 1" },
                { src: "/books/book/2.jpg", alt: "Dizajn naslovnice knjige 2" },
                { src: "/books/book/3.jpg", alt: "Dizajn naslovnice knjige 3" }
              ]
            }
          ]
        }
      }
    },
    {
      params: { id: 'print-media' },
      props: {
        category: {
          number: "05",
          title: "Razni Štampani Mediji",
          category: "Kategorija",
          description: "Raznovrsna kolekcija štampanih materijala uključujući letke, brošure i druge promotivne materijale dizajnirane za različite industrije i svrhe.",
          items: [
            {
              name: "Zerro Max Fascikl",
              description: "Dizajn brošure proizvoda",
              images: [
                { src: "/print-media/fascicle-zerromax/1.jpg", alt: "Zerro Max fascikl strana 1" },
                { src: "/print-media/fascicle-zerromax/2.jpg", alt: "Zerro Max fascikl strana 2" }
              ]
            },
            {
              name: "AdBlue Letak",
              description: "Dizajn letka proizvoda",
              images: [
                { src: "/print-media/flyer-adblue/1.jpg", alt: "AdBlue letak" }
              ]
            },
            {
              name: "Doma Letak",
              description: "Dizajn letka proizvoda",
              images: [
                { src: "/print-media/flyer-doma/1.jpg", alt: "Doma letak" }
              ]
            },
            {
              name: "Palma Letak",
              description: "Dizajn letka proizvoda",
              images: [
                { src: "/print-media/flyer-palma/1.jpg", alt: "Palma letak" }
              ]
            },
            {
              name: "Phoenix Letak",
              description: "Dizajn letka proizvoda",
              images: [
                { src: "/print-media/flyer-phoenix/1.jpg", alt: "Phoenix letak" }
              ]
            },
            {
              name: "Shams Letak",
              description: "Dizajn letka proizvoda",
              images: [
                { src: "/print-media/flyer-shams/1.jpg", alt: "Shams letak" }
              ]
            },
            {
              name: "Express Memorandum",
              description: "Dizajn memoranduma",
              images: [
                { src: "/print-media/memorandum-express/1.jpg", alt: "Express memorandum" }
              ]
            },
            {
              name: "Artane Trosklop",
              description: "Dizajn trosklopne brošure",
              images: [
                { src: "/print-media/trifold-artane/1.jpg", alt: "Artane trosklop strana 1" },
                { src: "/print-media/trifold-artane/2.jpg", alt: "Artane trosklop strana 2" },
                { src: "/print-media/trifold-artane/3.jpg", alt: "Artane trosklop strana 3" }
              ]
            }
          ]
        }
      }
    },
    {
      params: { id: 'social-media' },
      props: {
        category: {
          number: "06",
          title: "Sadržaj Društvenih Mreža",
          category: "Kategorija",
          description: "Kreativne kampanje na društvenim mrežama i sadržaj dizajniran za angažovanje publike i promociju brendova na različitim platformama.",
          items: [
            {
              name: "AdBlue",
              description: "Kampanja na društvenim mrežama",
              images: [
                { src: "/social-media/social-adblue/0.jpg", alt: "AdBlue sadržaj društvenih mreža" },
                { src: "/social-media/social-adblue/1.jpg", alt: "AdBlue sadržaj društvenih mreža" },
                { src: "/social-media/social-adblue/2.jpg", alt: "AdBlue sadržaj društvenih mreža" },
                { src: "/social-media/social-adblue/3.jpg", alt: "AdBlue sadržaj društvenih mreža" },
                { src: "/social-media/social-adblue/4.jpg", alt: "AdBlue sadržaj društvenih mreža" },
                { src: "/social-media/social-adblue/5.jpg", alt: "AdBlue sadržaj društvenih mreža" }
              ]
            },
            {
              name: "Doma",
              description: "Kampanja na društvenim mrežama",
              images: [
                { src: "/social-media/social-doma/1.jpg", alt: "Doma sadržaj društvenih mreža" },
                { src: "/social-media/social-doma/2.jpg", alt: "Doma sadržaj društvenih mreža" },
                { src: "/social-media/social-doma/3.jpg", alt: "Doma sadržaj društvenih mreža" },
                { src: "/social-media/social-doma/4.jpg", alt: "Doma sadržaj društvenih mreža" },
                { src: "/social-media/social-doma/5.jpg", alt: "Doma sadržaj društvenih mreža" }
              ]
            },
            {
              name: "Eurotim",
              description: "Kampanja na društvenim mrežama",
              images: [
                { src: "/social-media/social-eurotim/1.jpg", alt: "Eurotim sadržaj društvenih mreža" },
                { src: "/social-media/social-eurotim/2.jpg", alt: "Eurotim sadržaj društvenih mreža" },
                { src: "/social-media/social-eurotim/3.jpg", alt: "Eurotim sadržaj društvenih mreža" },
                { src: "/social-media/social-eurotim/4.jpg", alt: "Eurotim sadržaj društvenih mreža" },
                { src: "/social-media/social-eurotim/5.jpg", alt: "Eurotim sadržaj društvenih mreža" }
              ]
            },
            {
              name: "Mehanizmi",
              description: "Kampanja na društvenim mrežama",
              images: [
                { src: "/social-media/social-mehanizmi/1.png", alt: "Mehanizmi sadržaj društvenih mreža" },
                { src: "/social-media/social-mehanizmi/2.png", alt: "Mehanizmi sadržaj društvenih mreža" },
                { src: "/social-media/social-mehanizmi/3.png", alt: "Mehanizmi sadržaj društvenih mreža" },
                { src: "/social-media/social-mehanizmi/4.png", alt: "Mehanizmi sadržaj društvenih mreža" },
                { src: "/social-media/social-mehanizmi/5.png", alt: "Mehanizmi sadržaj društvenih mreža" }
              ]
            },
            {
              name: "Rework",
              description: "Kampanja na društvenim mrežama",
              images: [
                { src: "/social-media/social-rework/1.jpg", alt: "Rework sadržaj društvenih mreža" },
                { src: "/social-media/social-rework/2.jpg", alt: "Rework sadržaj društvenih mreža" },
                { src: "/social-media/social-rework/3.jpg", alt: "Rework sadržaj društvenih mreža" },
                { src: "/social-media/social-rework/4.jpg", alt: "Rework sadržaj društvenih mreža" },
                { src: "/social-media/social-rework/5.jpg", alt: "Rework sadržaj društvenih mreža" }
              ]
            }
          ]
        }
      }
    }
  ];
}

const { category } = Astro.props;
const { id } = Astro.params;
---

<Layout title={`${category.title} - ${category.category}`}>
  <main class="relative min-h-screen">
    <div class="fixed inset-0">
      <div class={`absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] ${
        id === 'visit-cards'
          ? 'from-rose-200/40 via-rose-100/30 to-transparent' 
          : id === 'books'
            ? 'from-emerald-200/40 via-emerald-100/30 to-transparent'
            : id === 'print-media'
              ? 'from-amber-200/40 via-amber-100/30 to-transparent'
              : id === 'branding'
                ? 'from-indigo-200/40 via-indigo-100/30 to-transparent'
                : id === 'social-media'
                  ? 'from-cyan-200/40 via-cyan-100/30 to-transparent'
                  : 'from-purple-200/40 via-purple-100/30 to-transparent'
      }`}></div>
    </div>

    <div class="relative">
      <article class="pt-24 pb-24">
        <div class="max-w-6xl mx-auto px-6 sm:px-8">
          <!-- Back Button -->
          <a 
            href={translatePath('/#portfolio')} 
            class={`
              inline-flex 
              items-center 
              gap-2 
              text-gray-500 
              ${
                id === 'visit-cards' ? 'hover:text-rose-600' : 
                id === 'books' ? 'hover:text-emerald-600' : 
                id === 'print-media' ? 'hover:text-amber-600' :
                id === 'branding' ? 'hover:text-indigo-600' :
                id === 'social-media' ? 'hover:text-cyan-600' :
                'hover:text-purple-600'
              }
              transition-colors 
              duration-300 
              mb-12 
              group
            `}
          >
            <ArrowLeft class="w-4 h-4 group-hover:-translate-x-1 transition-transform duration-300" />
            <span class="text-sm">{t('category.back_to_portfolio')}</span>
          </a>

          <!-- Header -->
          <header class="mb-16">
            <div>
              <div class={`flex items-center gap-2 ${
                id === 'visit-cards' ? 'text-rose-600' : 
                id === 'books' ? 'text-emerald-600' : 
                id === 'print-media' ? 'text-amber-600' :
                id === 'branding' ? 'text-indigo-600' :
                id === 'social-media' ? 'text-cyan-600' :
                'text-purple-600'
              } mb-6`}>
                <span class="font-mono">{category.number}</span>
                <span class="text-gray-300">—</span>
                <span>{t('portfolio.category')}</span>
              </div>
              <p class="text-xl text-gray-600 max-w-2xl">
                {category.description}
              </p>
            </div>
          </header>

          <!-- Catalogs List -->
          <div class="space-y-40">
            {category.items.map((item, itemIndex) => (
              <div class="catalog-item">
                <!-- Text Section -->
                <div class="mb-12">
                  <h2 class="text-4xl font-bold mb-4">{item.name}</h2>
                  <p class="text-lg text-gray-600 mb-8 max-w-4xl">{item.description}</p>
                  <div class="flex items-center">
                    <span class={`inline-flex items-center py-1.5 px-3 ${
                      id === 'visit-cards' ? 'bg-rose-50/70' : 
                      id === 'books' ? 'bg-emerald-50/70' : 
                      id === 'print-media' ? 'bg-amber-50/70' :
                      id === 'branding' ? 'bg-indigo-50/70' :
                      id === 'social-media' ? 'bg-cyan-50/70' :
                      'bg-purple-50/70'
                    } text-sm text-gray-800 rounded-full`}>
                      <span class={`w-1.5 h-1.5 ${
                        id === 'visit-cards' ? 'bg-rose-500' : 
                        id === 'books' ? 'bg-emerald-500' : 
                        id === 'print-media' ? 'bg-amber-500' :
                        id === 'branding' ? 'bg-indigo-500' :
                        id === 'social-media' ? 'bg-cyan-500' :
                        'bg-purple-500'
                      } rounded-full mr-2`}></span>
                      {item.images.length} {item.images.length === 1 ? t('category.image') : t('category.images')}
                    </span>
                  </div>
                </div>
                
                <!-- Swiper Carousel OR Social Media Grid OR Branding Vertical Layout -->
                {id === 'social-media' ? (
                  <!-- Social Media Grid Layout (Desktop) / Slider (Mobile/Tablet) -->
                  <div class="social-media-container">
                    <!-- Desktop Grid -->
                    <div class={`social-media-grid images-${Math.min(item.images.length, 5)} hidden lg:grid`}>
                      {item.images.slice(0, 5).map((image, index) => (
                        <div class={`grid-item item-${index + 1}`}>
                          <div class="relative w-full h-full group cursor-pointer overflow-hidden rounded-2xl">
                            <img 
                              src={image.src} 
                              alt={image.alt || `${item.name} image ${index + 1}`}
                              loading={index === 0 ? "eager" : "lazy"}
                              decoding="async"
                              fetchpriority={index === 0 ? "high" : "auto"}
                              class="w-full h-full object-cover transition-all duration-500 ease-out group-hover:scale-[1.02]"
                              data-fullview={image.src}
                            />
                            
                            {/* Subtle hover overlay */}
                            <div class="absolute inset-0 bg-black/0 transition-all duration-500 ease-out group-hover:bg-black/5 rounded-2xl"></div>
                            
                            {/* Fullscreen button */}
                            <button 
                              class="fullscreen-btn absolute top-3 right-3 bg-white/90 backdrop-filter backdrop-blur-sm p-2 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out hover:bg-white hover:scale-105 hover:shadow-xl z-10"
                              data-fullview={image.src}
                              data-alt={image.alt}
                            >
                              <Maximize2 class="w-4 h-4 text-cyan-600" />
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    <!-- Mobile/Tablet Slider -->
                    <div class={`category-swiper-${itemIndex} relative lg:hidden`}>
                      <div class="swiper-container relative rounded-2xl overflow-hidden">
                        <div class="swiper-wrapper">
                          {item.images.map((image, index) => (
                            <div class="swiper-slide">
                              <div class="relative w-full group cursor-pointer">
                                <img 
                                  src={image.src} 
                                  alt={image.alt || `${item.name} image ${index + 1}`}
                                  loading={index === 0 ? "eager" : "lazy"}
                                  decoding="async"
                                  fetchpriority={index === 0 ? "high" : "auto"}
                                  class="w-full h-auto object-contain rounded-2xl transition-all duration-500 ease-out group-hover:scale-[1.02]"
                                  data-fullview={image.src}
                                />
                                
                                {/* Controls float over the image */}
                                <div class="absolute inset-0 bg-black/0 transition-all duration-500 ease-out group-hover:bg-black/5 rounded-2xl"></div>
                                
                                {/* Fullscreen button */}
                                <button 
                                  class="fullscreen-btn absolute top-4 right-4 bg-white/90 backdrop-filter backdrop-blur-sm p-2.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out hover:bg-white hover:scale-105 hover:shadow-xl z-10"
                                  data-fullview={image.src}
                                  data-alt={image.alt}
                                >
                                  <Maximize2 class="w-5 h-5 text-cyan-600" />
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                        
                        {/* Navigation buttons - only show if more than 1 image */}
                        {item.images.length > 1 && (
                          <>
                            <button class={`swiper-button-prev category-nav-btn category-nav-prev-${itemIndex}`}>
                              <ChevronLeft class="w-7 h-7 text-cyan-600" />
                            </button>
                            <button class={`swiper-button-next category-nav-btn category-nav-next-${itemIndex}`}>
                              <ChevronRight class="w-7 h-7 text-cyan-600" />
                            </button>
                          </>
                        )}
                      </div>

                    </div>
                  </div>
                ) : id === 'branding' ? (
                  <!-- Branding Vertical Stack Layout -->
                  <div class="branding-vertical-stack space-y-8">
                    {item.images.map((image, index) => (
                      <div class="branding-image-container">
                        <div class="relative group cursor-pointer">
                            <img 
                              src={image.src} 
                              alt={image.alt || `${item.name} image ${index + 1}`}
                              loading={index === 0 ? "eager" : "lazy"}
                              decoding="async"
                              fetchpriority={index === 0 ? "high" : "auto"}
                              class="w-full h-auto object-contain rounded-2xl transition-all duration-500 ease-out group-hover:scale-[1.02]"
                              data-fullview={image.src}
                            />
                          
                          {/* Subtle hover overlay */}
                          <div class="absolute inset-0 bg-black/0 transition-all duration-500 ease-out group-hover:bg-black/3 rounded-2xl"></div>
                          
                          {/* Fullscreen button */}
                          <button 
                            class="fullscreen-btn absolute top-4 right-4 bg-white/95 backdrop-filter backdrop-blur-sm p-2.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out hover:bg-white hover:scale-105 hover:shadow-xl z-10"
                            data-fullview={image.src}
                            data-alt={image.alt}
                          >
                            <Maximize2 class="w-5 h-5 text-indigo-600" />
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <!-- Original Swiper Carousel for other categories -->
                  <div class={`category-swiper-${itemIndex} relative`}>
                    <div class="swiper-container relative rounded-2xl overflow-hidden">
                      <div class="swiper-wrapper">
                        {item.images.map((image, index) => (
                          <div class="swiper-slide">
                            <div class="relative w-full group cursor-pointer">
                              <img 
                                src={image.src} 
                                alt={image.alt || `${item.name} image ${index + 1}`}
                                loading={index === 0 ? "eager" : "lazy"}
                                decoding="async"
                                fetchpriority={index === 0 ? "high" : "auto"}
                                class="w-full h-auto object-contain rounded-2xl transition-all duration-500 ease-out group-hover:scale-[1.02]"
                                data-fullview={image.src}
                              />
                              
                              {/* Controls float over the image */}
                              <div class="absolute inset-0 bg-black/0 transition-all duration-500 ease-out group-hover:bg-black/5 rounded-2xl"></div>
                              
                              {/* Fullscreen button */}
                              <button 
                                class="fullscreen-btn absolute top-4 right-4 bg-white/90 backdrop-filter backdrop-blur-sm p-2.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 ease-out hover:bg-white hover:scale-105 hover:shadow-xl z-10"
                                data-fullview={image.src}
                                data-alt={image.alt}
                              >
                                <Maximize2 class={`w-5 h-5 ${
                                  id === 'visit-cards' ? 'text-rose-600' : 
                                  id === 'books' ? 'text-emerald-600' : 
                                  id === 'print-media' ? 'text-amber-600' :
                                  id === 'branding' ? 'text-indigo-600' :
                                  id === 'social-media' ? 'text-cyan-600' :
                                  'text-purple-600'
                                }`} />
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      {/* Navigation buttons positioned over the image */}
                      {item.images.length > 1 && (
                        <>
                          <button class={`swiper-button-prev category-nav-btn category-nav-prev-${itemIndex}`}>
                            <ChevronLeft class={`w-7 h-7 ${
                              id === 'visit-cards' ? 'text-rose-600' : 
                              id === 'books' ? 'text-emerald-600' : 
                              id === 'print-media' ? 'text-amber-600' :
                              id === 'branding' ? 'text-indigo-600' :
                              id === 'social-media' ? 'text-cyan-600' :
                              'text-purple-600'
                            }`} />
                          </button>
                          <button class={`swiper-button-next category-nav-btn category-nav-next-${itemIndex}`}>
                            <ChevronRight class={`w-7 h-7 ${
                              id === 'visit-cards' ? 'text-rose-600' : 
                              id === 'books' ? 'text-emerald-600' : 
                              id === 'print-media' ? 'text-amber-600' :
                              id === 'branding' ? 'text-indigo-600' :
                              id === 'social-media' ? 'text-cyan-600' :
                              'text-purple-600'
                            }`} />
                          </button>
                        </>
                      )}

                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </article>

      <!-- Full-size image viewer -->
      <div id="imageViewer" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
        <button id="closeViewer" class="absolute top-6 right-6 text-white hover:text-gray-300">
          <X class="w-8 h-8" />
        </button>
        <button id="prevImage" class="absolute left-4 md:left-6 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 bg-black/50 hover:bg-black/70 p-3 rounded-full transition-all z-10">
          <ChevronLeft class="w-8 h-8 md:w-10 md:h-10" />
        </button>
        <img id="fullImage" src="" alt="Full size image" class="max-h-[90vh] max-w-[90vw] object-contain" />
        <button id="nextImage" class="absolute right-4 md:right-6 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 bg-black/50 hover:bg-black/70 p-3 rounded-full transition-all z-10">
          <ChevronRight class="w-8 h-8 md:w-10 md:h-10" />
        </button>
      </div>

      <Footer />
    </div>
  </main>
</Layout>

<style>
  /* Navigation buttons */
  .category-nav-btn {
    position: absolute !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    width: 60px !important;
    height: 60px !important;
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(16px) !important;
    border: none !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    z-index: 20 !important;
    opacity: 1 !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
    will-change: transform, opacity !important;
  }

  .category-nav-btn[class*="prev"] {
    left: 24px !important;
  }

  .category-nav-btn[class*="next"] {
    right: 24px !important;
  }

  .category-nav-btn:hover {
    background: rgba(255, 255, 255, 1) !important;
    transform: translateY(-50%) scale(1.05) !important;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.16) !important;
  }

  .category-nav-btn:active {
    transform: translateY(-50%) scale(0.95) !important;
  }

  /* Remove default swiper button styles */
  .swiper-button-prev:after,
  .swiper-button-next:after {
    display: none !important;
  }

  /* Touch/mobile improvements */
  @media (max-width: 768px) {
    .category-nav-btn {
      opacity: 1 !important;
      width: 40px !important;
      height: 40px !important;
    }
    
    .swiper-pagination {
      opacity: 1;
    }

    .swiper-container {
      border-radius: 0.75rem;
    }
  }

  /* Image loading styles */
  .loading-indicator {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #f3f4f6;
    z-index: 1;
    overflow: hidden;
  }
  
  .loading-indicator::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    animation: shimmer 1.5s infinite;
    transform: translateX(-100%);
  }

  img {
    opacity: 1;
    transition: opacity 0.3s ease;
    position: relative;
    z-index: 2;
  }

  img.loaded {
    opacity: 1;
  }

  @keyframes shimmer {
    100% {
      transform: translateX(100%);
    }
  }

  #fullImage {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #fullImage.loaded {
    opacity: 1;
  }

  /* Swiper Container */
  .swiper-container {
    width: 100%;
  }

  .swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    background: transparent;
  }

  .swiper-slide img {
    transition: transform 0.5s ease-out, filter 0.3s ease-out;
    will-change: transform;
  }

  /* Branding Vertical Stack Layout */
  .branding-vertical-stack {
    width: 100%;
  }

  /* Mobile responsive for branding */
  @media (max-width: 768px) {
    .branding-vertical-stack {
      gap: 1.5rem;
    }
    
    .branding-image-container img {
      max-height: 60vh !important;
    }
    
    .branding-image-container .fullscreen-btn {
      top: 12px !important;
      right: 12px !important;
      padding: 8px !important;
    }
    
    .branding-image-container .fullscreen-btn .lucide {
      width: 18px !important;
      height: 18px !important;
    }
  }

  /* Social Media Grid Layout - only on desktop */
  @media (min-width: 1024px) {
    .social-media-grid {
      display: grid;
      gap: 16px;
      width: 100%;
      min-height: 500px;
    }
  }

  /* Grid layouts - exactly like the reference image */
  .social-media-grid.images-1 {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  .social-media-grid.images-2 {
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr;
  }

  .social-media-grid.images-3 {
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr 1fr;
  }

  .social-media-grid.images-4 {
    grid-template-columns: 2fr 1fr 1fr;
    grid-template-rows: 1fr 1fr;
  }

  .social-media-grid.images-5 {
    grid-template-columns: 2fr 1fr 1fr;
    grid-template-rows: 1fr 1fr;
  }

  /* Grid item positioning */
  .grid-item {
    background: transparent;
  }

  /* First item is always large - spans full height */
  .images-2 .item-1,
  .images-3 .item-1,
  .images-4 .item-1,
  .images-5 .item-1 {
    grid-column: 1;
    grid-row: 1 / -1;
  }

  /* Two images layout */
  .images-2 .item-2 {
    grid-column: 2;
    grid-row: 1;
  }

  /* Three images layout */
  .images-3 .item-2 {
    grid-column: 2;
    grid-row: 1;
  }

  .images-3 .item-3 {
    grid-column: 2;
    grid-row: 2;
  }

  /* Four images layout - 2x2 grid on the right */
  .images-4 .item-2 {
    grid-column: 2;
    grid-row: 1;
  }

  .images-4 .item-3 {
    grid-column: 3;
    grid-row: 1;
  }

  .images-4 .item-4 {
    grid-column: 2;
    grid-row: 2;
  }

  /* Five images layout - 2x2 grid on the right */
  .images-5 .item-2 {
    grid-column: 2;
    grid-row: 1;
  }

  .images-5 .item-3 {
    grid-column: 3;
    grid-row: 1;
  }

  .images-5 .item-4 {
    grid-column: 2;
    grid-row: 2;
  }

  .images-5 .item-5 {
    grid-column: 3;
    grid-row: 2;
  }

  /* Mobile responsive - only applies when grid is visible (desktop) */
  @media (min-width: 1024px) and (max-width: 768px) {
    /* This media query will never match, effectively disabling mobile grid styles */
  }

  /* Social Media Grid Layout */
  .social-media-grid {
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: repeat(12, 1fr);
    gap: 8px;
    aspect-ratio: 16/9;
    max-height: 600px;
  }

  .social-media-grid.images-1 .item-1 {
    grid-column: 1 / -1;
    grid-row: 1 / -1;
  }

  .social-media-grid.images-2 .item-1 {
    grid-column: 1 / 7;
    grid-row: 1 / -1;
  }

  .social-media-grid.images-2 .item-2 {
    grid-column: 7 / -1;
    grid-row: 1 / -1;
  }

  .social-media-grid.images-3 .item-1 {
    grid-column: 1 / 7;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-3 .item-2 {
    grid-column: 7 / -1;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-3 .item-3 {
    grid-column: 1 / -1;
    grid-row: 7 / -1;
  }

  .social-media-grid.images-4 .item-1 {
    grid-column: 1 / 7;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-4 .item-2 {
    grid-column: 7 / -1;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-4 .item-3 {
    grid-column: 1 / 7;
    grid-row: 7 / -1;
  }

  .social-media-grid.images-4 .item-4 {
    grid-column: 7 / -1;
    grid-row: 7 / -1;
  }

  .social-media-grid.images-5 .item-1 {
    grid-column: 1 / 7;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-5 .item-2 {
    grid-column: 7 / -1;
    grid-row: 1 / 7;
  }

  .social-media-grid.images-5 .item-3 {
    grid-column: 1 / 5;
    grid-row: 7 / -1;
  }

  .social-media-grid.images-5 .item-4 {
    grid-column: 5 / 9;
    grid-row: 7 / -1;
  }

  .social-media-grid.images-5 .item-5 {
    grid-column: 9 / -1;
    grid-row: 7 / -1;
  }

  /* Branding Vertical Stack */
  .branding-vertical-stack {
    max-width: 800px;
    margin: 0 auto;
  }

  .branding-image-container {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: 
      0 4px 6px -1px rgba(0, 0, 0, 0.1), 
      0 2px 4px -1px rgba(0, 0, 0, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Image Viewer */
  #imageViewer {
    backdrop-filter: blur(8px);
  }

  #imageViewer img {
    transition: opacity 0.3s ease;
  }

  #imageViewer img.loaded {
    opacity: 1;
  }

  #imageViewer img:not(.loaded) {
    opacity: 0;
  }

  /* Loading Indicator */
  .loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 5;
  }

  @keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .category-nav-btn {
      width: 40px;
      height: 40px;
    }

    .category-nav-btn.swiper-button-prev {
      left: 8px;
    }

    .category-nav-btn.swiper-button-next {
      right: 8px;
    }

    .social-media-grid {
      aspect-ratio: 4/3;
    }
  }

  /* Floating animations */
  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-12px) rotate(1deg); }
    66% { transform: translateY(-6px) rotate(-1deg); }
  }

  .floating-shape {
    animation: float 6s ease-in-out infinite;
  }

  /* Portfolio category animations */
  .portfolio-category {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out forwards;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .portfolio-category.reverse {
    animation-delay: 0.2s;
  }

  /* Portfolio item wrapper */
  .portfolio-item-wrapper {
    position: relative;
    z-index: 1;
  }

  /* Hover effects */
  .catalog-item:hover {
    transform: translateY(-2px);
    transition: transform 0.3s ease;
  }

  /* Swiper pagination customization */
  .swiper-pagination-bullet {
    background: rgba(255, 255, 255, 0.6) !important;
    border: 2px solid rgba(255, 255, 255, 0.8) !important;
    opacity: 1 !important;
    transition: all 0.3s ease !important;
  }

  .swiper-pagination-bullet-active {
    background: var(--swiper-pagination-color, #3b82f6) !important;
    border-color: var(--swiper-pagination-color, #3b82f6) !important;
    transform: scale(1.2) !important;
  }
</style>

<script>
  import Swiper from 'swiper';
  import { Navigation, Pagination, Autoplay } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/navigation';
  import 'swiper/css/pagination';
  import { preloadImage, getCachedImage } from '../../../utils/imageCache';

  // Color mapping for pagination
  const colorMap: Record<string, string> = {
    'visit-cards': '#e11d48',
    'books': '#059669', 
    'print-media': '#d97706',
    'branding': '#4f46e5',
    'social-media': '#0891b2',
    'catalogs': '#9333ea'
  };

  // Get current category from URL
  const categoryId = window.location.pathname.split('/').pop() || 'catalogs';
  const currentColor = colorMap[categoryId] || '#9333ea';

  document.addEventListener('DOMContentLoaded', () => {
    // Setup image loading and click handlers first
    setupImageLoading();
    setupFullscreenHandlers();

    // Initialize all Swiper instances
    const swiperContainers = document.querySelectorAll('.swiper-container');
    
    swiperContainers.forEach((container, index) => {
      const swiper = new Swiper(container as HTMLElement, {
        modules: [Navigation, Pagination, Autoplay],
        slidesPerView: 1,
        spaceBetween: 0,
        grabCursor: true,
        touchRatio: 1,
        resistance: true,
        resistanceRatio: 0.85,
        loop: container.querySelectorAll('.swiper-slide').length > 1,
        speed: 600,
        autoplay: container.querySelectorAll('.swiper-slide').length > 1 ? {
          delay: 5000,
          disableOnInteraction: false,
          pauseOnMouseEnter: true,
        } : false,
        navigation: {
          nextEl: container.querySelector(`.category-nav-next-${index}`) as HTMLElement,
          prevEl: container.querySelector(`.category-nav-prev-${index}`) as HTMLElement,
        },
        pagination: {
          el: document.querySelector(`.pagination-${categoryId}-${index}`) as HTMLElement,
          clickable: true,
          dynamicBullets: false,
        },
        on: {
          init: function() {
            // Apply colors after initialization
            setTimeout(() => {
              const bullets = container.querySelectorAll('.swiper-pagination-bullet');
              bullets.forEach((bullet: Element) => {
                const htmlBullet = bullet as HTMLElement;
                if (htmlBullet.classList.contains('swiper-pagination-bullet-active')) {
                  htmlBullet.style.backgroundColor = currentColor;
                  htmlBullet.style.borderColor = currentColor;
                }
              });
            }, 100);
          },
          slideChange: function() {
            // Reapply colors on slide change
            const bullets = container.querySelectorAll('.swiper-pagination-bullet');
            bullets.forEach((bullet: Element) => {
              const htmlBullet = bullet as HTMLElement;
              if (htmlBullet.classList.contains('swiper-pagination-bullet-active')) {
                htmlBullet.style.backgroundColor = currentColor;
                htmlBullet.style.borderColor = currentColor;
              } else {
                htmlBullet.style.backgroundColor = 'rgba(255, 255, 255, 0.6)';
                htmlBullet.style.borderColor = 'rgba(255, 255, 255, 0.8)';
              }
            });
          }
        }
      });
    });
  });

  // Setup image loading and click handlers
  function setupImageLoading() {
    document.querySelectorAll('img[data-fullview]').forEach(img => {
      // Create and add loading indicator
      const parent = img.parentElement;
      if (parent && !parent.querySelector('.loading-indicator')) {
        // Add a loading indicator div
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'loading-indicator';
        parent.appendChild(loadingDiv);
        
        // Handler to remove loading indicator
        const removeLoading = () => {
          const indicator = parent.querySelector('.loading-indicator');
          if (indicator) {
            indicator.remove();
          }
        };

        // Remove loading indicator when image loads
        img.addEventListener('load', removeLoading);
        img.addEventListener('error', removeLoading);
        
        // Remove loading indicator after a timeout as fallback
        setTimeout(removeLoading, 5000);
      }
    });
  }

  // Fullscreen viewer variables
  let currentImages: string[] = [];
  let currentIndex = 0;

  // Touch variables for mobile navigation
  let touchStartX = 0;
  let touchEndX = 0;
  
  // Handle swipe direction
  function handleSwipe() {
    const viewer = document.getElementById('imageViewer');
    if (viewer && !viewer.classList.contains('hidden') && currentImages.length > 1) {
      const swipeThreshold = 50;
      const swipeDistance = touchEndX - touchStartX;
      
      if (swipeDistance < -swipeThreshold) {
        currentIndex = (currentIndex + 1) % currentImages.length;
        updateViewerImage();
      } else if (swipeDistance > swipeThreshold) {
        currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
        updateViewerImage();
      }
    }
  }
  
  // Setup touch events for fullscreen navigation
  function setupTouchEvents() {
    const fullImage = document.getElementById('fullImage');
    if (fullImage) {
      fullImage.removeEventListener('touchstart', handleTouchStart);
      fullImage.removeEventListener('touchend', handleTouchEnd);
      
      fullImage.addEventListener('touchstart', handleTouchStart, { passive: true });
      fullImage.addEventListener('touchend', handleTouchEnd, { passive: true });
    }
  }
  
  // Touch event handlers
  function handleTouchStart(e: TouchEvent) {
    touchStartX = e.changedTouches[0].screenX;
  }
  
  function handleTouchEnd(e: TouchEvent) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  }

  // Setup click handlers for both images and fullscreen buttons
  function setupFullscreenHandlers() {
    document.querySelectorAll('img[data-fullview]').forEach(img => {
      img.addEventListener('click', () => {
        openFullscreenViewer(img as HTMLImageElement);
      });
    });

    document.querySelectorAll('.fullscreen-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const container = btn.closest('.group, .relative');
        if (container) {
          const img = container.querySelector('img[data-fullview]') as HTMLImageElement;
          if (img) {
            openFullscreenViewer(img);
          }
        }
      });
    });
  }

  // Function to open fullscreen viewer
  function openFullscreenViewer(img: HTMLImageElement) {
    const fullview = img.getAttribute('data-fullview');
    const viewer = document.getElementById('imageViewer');
    const fullImage = document.getElementById('fullImage') as HTMLImageElement;
    
    if (fullview && viewer && fullImage) {
      fullImage.classList.remove('loaded');
      
      // Find the container that contains this image
      const swiperContainer = img.closest('[class*="category-swiper"]');
      const brandingContainer = img.closest('.branding-vertical-stack');
      const socialGridContainer = img.closest('.social-media-grid');
      const socialContainer = img.closest('.social-media-container');
      
      currentImages = [];
      
      if (swiperContainer) {
        // Handle swiper containers (catalogs, books, print-media, visit-cards, social-media mobile)
        swiperContainer.querySelectorAll('img[data-fullview]').forEach(itemImg => {
          const imgSrc = itemImg.getAttribute('data-fullview');
          if (imgSrc) {
            currentImages.push(imgSrc);
          }
        });
      } else if (brandingContainer) {
        // Handle branding vertical stack
        brandingContainer.querySelectorAll('img[data-fullview]').forEach(itemImg => {
          const imgSrc = itemImg.getAttribute('data-fullview');
          if (imgSrc) {
            currentImages.push(imgSrc);
          }
        });
      } else if (socialGridContainer) {
        // Handle social media grid (desktop only)
        socialGridContainer.querySelectorAll('img[data-fullview]').forEach(itemImg => {
          const imgSrc = itemImg.getAttribute('data-fullview');
          if (imgSrc) {
            currentImages.push(imgSrc);
          }
        });
      } else if (socialContainer) {
        // Handle social media container (fallback)
        socialContainer.querySelectorAll('img[data-fullview]').forEach(itemImg => {
          const imgSrc = itemImg.getAttribute('data-fullview');
          if (imgSrc) {
            currentImages.push(imgSrc);
          }
        });
      }
      
      // Find the index of the clicked image
      currentIndex = currentImages.indexOf(fullview);
      if (currentIndex === -1) currentIndex = 0;
      
      // Show viewer and load image
      viewer.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      setupTouchEvents();
      
      // Load the image
      fullImage.src = fullview;
      fullImage.alt = img.alt || 'Full size image';
      
      // Show image when loaded
      fullImage.onload = () => {
        fullImage.classList.add('loaded');
      };
      
      // Update navigation buttons
      updateNavigationButtons();
    }
  }

  // Function to update viewer image
  function updateViewerImage() {
    const fullImage = document.getElementById('fullImage') as HTMLImageElement;
    if (fullImage && currentImages.length > 0) {
      fullImage.classList.remove('loaded');
      fullImage.src = currentImages[currentIndex];
      
      fullImage.onload = () => {
        fullImage.classList.add('loaded');
      };
      
      updateNavigationButtons();
    }
  }

  // Function to update navigation buttons
  function updateNavigationButtons() {
    const prevBtn = document.getElementById('prevImage');
    const nextBtn = document.getElementById('nextImage');
    
    if (prevBtn) {
      prevBtn.style.display = currentImages.length > 1 ? 'flex' : 'none';
    }
    
    if (nextBtn) {
      nextBtn.style.display = currentImages.length > 1 ? 'flex' : 'none';
    }
  }

  // Close viewer function
  function closeViewer() {
    const viewer = document.getElementById('imageViewer');
    if (viewer) {
      viewer.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }

  // Navigation functions
  function showPrevImage() {
    if (currentImages.length > 1) {
      currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
      updateViewerImage();
    }
  }

  function showNextImage() {
    if (currentImages.length > 1) {
      currentIndex = (currentIndex + 1) % currentImages.length;
      updateViewerImage();
    }
  }

  // Event listeners for viewer controls
  document.addEventListener('DOMContentLoaded', () => {
    const closeBtn = document.getElementById('closeViewer');
    const prevBtn = document.getElementById('prevImage');
    const nextBtn = document.getElementById('nextImage');
    const viewer = document.getElementById('imageViewer');

    if (closeBtn) {
      closeBtn.addEventListener('click', closeViewer);
    }

    if (prevBtn) {
      prevBtn.addEventListener('click', showPrevImage);
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', showNextImage);
    }

    if (viewer) {
      viewer.addEventListener('click', (e) => {
        if (e.target === viewer) {
          closeViewer();
        }
      });
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (viewer && !viewer.classList.contains('hidden')) {
        switch (e.key) {
          case 'Escape':
            closeViewer();
            break;
          case 'ArrowLeft':
            showPrevImage();
            break;
          case 'ArrowRight':
            showNextImage();
            break;
        }
      }
    });
  });
</script> 